var p=require("@serverless-devs/core"),{CatchableError:t,lodash:e,fse:$,rimraf:q,getCredential:g,spinner:w,Logger:y}=p,D=new y("cdn-fc-plugin"),d=require("@alicloud/fc-open20210406"),N=d.default,h=d.ListCustomDomainsRequest,v=require("@alicloud/openapi-client").Config,r=w("start action");module.exports=async function(n,a){let s=a.serviceName,c=a.functionName;if(r.start("cdn-fc-plugin working!"),e.isEmpty(s))throw new t("plugin cdn-fc-plugin's args : serviceName is required!");if(e.isEmpty(c))throw new t("plugin cdn-fc-plugin's args : serviceName is required!");let i=n.credentials;e.isEmpty(i)&&(n.credentials=await g(n.project.access),i=n.credentials);let m=new v({accessKeyId:i.AccessKeyID,accessKeySecret:i.AccessKeySecret,securityToken:i.SecurityToken});m.endpoint="1656564022886445.cn-shenzhen.fc.aliyuncs.com";let f=new N(m),l=new h({prefix:`${c}.${s}`,limit:1}),u=(await f.listCustomDomains(l)).body.customDomains;if(e.isEmpty(u))throw new t(`cannot find the service<${s}> function <${c}> 's domainName `);let o=u[0].domainName;if(e.isEmpty(o))throw new t(`cannot find the service<${s}> function <${c}> 's domainName `);return r.info(`get service<${s}> function <${c}> 's domainName<${o}> successed!`),r.stop(),e.merge(n,{props:{sources:[{type:"fc_domain",content:o}]}})};
